# Project: Sanic + PostgreSQL

## Описание
Проект представляет собой backend-сервис на Sanic с асинхронным доступом к PostgreSQL через SQLAlchemy 2.x.  
Поддерживается работа с пользователями, счетами и платежами.  

---
Для запуска нужно создать .env файл по примеру env.example

##  Запуск через Docker
Настроить .env для запуска в докер:

* DATABASE_URL=postgresql+asyncpg://app:app@db:5432/app


Собрать и запустить контейнеры:

docker-compose up --build

Приложение будет доступно по адресу:
-
http://localhost:8000

Применить миграции (если нужно отдельно):
-
docker-compose run --rm app alembic upgrade head

Локальный запуск без Docker
-
Создать и активировать виртуальное окружение:


* python -m venv .venv
* .venv\Scripts\activate    # Windows
* .venv/bin/activate  # Linux/macOS

Установить зависимости:
-

pip install -r requirements.txt

Установить PostgreSQL, создать базу данных и пользователя.

Настроить .env:

* DATABASE_URL=postgresql+asyncpg://postgres:123@localhost:5432/postgres

Применить миграции:

* alembic upgrade head

Запустить сервер:

sanic main.app  --dev --host=0.0.0.0 --port=8000

Маршруты API
-
Для авторизации используется маршрут auth/login с указанием тела запроса с данными сидов:
#### Пользователь
{
    "email": "user@example.com",
    "password": "user12345"
}

#### Админ
{
  "email": "admin@example.com",
  "password": "admin12345"
}
### Админские маршруты (требуется JWT + is_admin=True)

| Метод | Путь | Описание |
|-------|------|----------|
| GET   | `/admin/me` | Получить данные текущего админа |
| GET   | `/admin/users` | Список всех пользователей с их базовой информацией |
| POST  | `/admin/users` | Создать нового пользователя |
| DELETE| `/admin/users/<user_id:int>` | Удалить пользователя по ID |
| PATCH | `/admin/users/<user_id:int>` | Обновить данные пользователя по ID |
| GET   | `/admin/users/<user_id:int>/accounts` | Получить список счетов конкретного пользователя |

Авторизация
---

| Метод | Путь       | Описание |
|-------|------------|----------|
| POST  | `auth/login` | Аутентификация пользователя и получение JWT токена |

Пользовательские маршруты
---

| Метод | Путь | Описание |
|-------|------|----------|
| GET   | `/me` | Получить данные текущего аутентифицированного пользователя |
| GET   | `/me/accounts` | Получить список счетов текущего пользователя |
| GET   | `/me/payments` | Получить список платежей текущего пользователя |

Платежные вебхуки
---

| Метод | Путь | Описание |
|-------|------|----------|
| POST  | `webhooks/payment` | Обработка входящего вебхука платежа. Валидирует подпись, создает запись платежа и обновляет баланс аккаунта. |
